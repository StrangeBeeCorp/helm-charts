################################
# TheHive Helm Chart variables #
################################

# -- Override the name of the chart
nameOverride: ""
# -- Override the full name of the chart
fullnameOverride: ""

# -- Image pull secrets for private registries
imagePullSecrets: []
#  - name: "image-pull-secret"

thehive:
  # -- Additional labels to attach to TheHive resources
  labels: {}
  # -- Additional annotations to attach to TheHive resources
  annotations: {}

  # -- Additional labels to attach to TheHive pods
  podLabels: {}
  # -- Additional annotations to attach to TheHive pods
  podAnnotations: {}

  # -- Number of TheHive replicas (only used when thehive.autoscaling.enabled is false)
  replicas: 1

  strategy:
    # -- Deployment strategy type. Set to "RollingUpdate" or "Recreate" depending on HA needs and TheHive version upgrade (schema migrations)
    type: RollingUpdate
    rollingUpdate:
      # -- Maximum number of pods that can be created over the desired number of pods (only for RollingUpdate)
      maxSurge: 1
      # -- Maximum number of pods that can be unavailable during the update (only for RollingUpdate)
      maxUnavailable: 1

  # -- Maximum number of unavailable pods in PodDisruptionBudget
  maxUnavailable: 1

  # -- Minimum number of TheHive nodes to form a cluster
  clusterMinNodesCount: 1

  autoscaling:
    # -- Enable horizontal pod autoscaling
    enabled: false
    # -- Minimum number of replicas for autoscaling
    minReplicas: 2
    # -- Maximum number of replicas for autoscaling
    maxReplicas: 4
    # -- Target CPU utilization percentage for autoscaling
    targetCPUUtilizationPercentage: 80
    # -- Target memory utilization percentage for autoscaling
    #targetMemoryUtilizationPercentage: 95

  # -- Resource requests and limits for TheHive pods
  resources:
    requests:
      cpu: "1000m"
      memory: "2048Mi"
      ephemeral-storage: "4Gi"
    limits:
      cpu: "3000m"
      memory: "3584Mi"
      ephemeral-storage: "4Gi"

  # -- JVM options for TheHive application
  jvmOpts: "-Xms2g -Xmx2g -Xmn300m"

  image:
    # -- Docker registry for TheHive image
    registry: docker.io
    # -- TheHive image repository
    repository: strangebee/thehive
    # -- TheHive image tag (defaults to chart appVersion if not set)
    tag: ""
    # -- Image pull policy
    pullPolicy: IfNotPresent

  database:
    # -- Cassandra username for database connection
    username: "cassandra"
    # -- Cassandra password for database connection (should match Cassandra subchart credentials if enabled)
    password: "ChangeThisPasswordForCassandra"
    # -- Name of existing Kubernetes secret containing Cassandra password
    k8sSecretName: ""
    # -- Key in the secret containing Cassandra password
    k8sSecretKey: "cassandra-password"
    # -- List of Cassandra hostnames (auto-configured if Cassandra subchart is enabled and this is empty)
    hostnames: []
      #- "mycassandra.example.com"
    # -- Wait 30 seconds before starting TheHive (can be used to give time for Cassandra to start)
    wait: false

  index:
    # -- ElasticSearch username for index connection
    username: "elastic"
    # -- ElasticSearch password for index connection (should match ElasticSearch subchart credentials if enabled)
    password: ""
    # -- Name of existing Kubernetes secret containing ElasticSearch password
    k8sSecretName: ""
    # -- Key in the secret containing ElasticSearch password
    k8sSecretKey: "elasticsearch-password"
    # -- List of ElasticSearch hostnames (auto-configured if ElasticSearch subchart is enabled and this is empty)
    hostnames: []
      #- "myelasticsearch.example.com"

  storage:
    # -- Access key for object storage connection (should match MinIO subchart credentials if enabled)
    accessKey: "minio"
    # -- Secret key for object storage connection (should match MinIO subchart credentials if enabled)
    secretKey: "ChangeThisPasswordForMinIO"
    # -- Name of existing Kubernetes secret containing object storage secret key
    k8sSecretName: ""
    # -- Key in the secret containing object storage secret key
    k8sSecretKey: "rootPassword"
    # -- Object storage endpoint URL (auto-configured if MinIO subchart is enabled and this is empty)
    endpoint: ""
    # -- Object storage bucket name for TheHive data
    bucket: "thehive"
    # -- Object storage region
    region: "us-east-1"
    # -- Use path-style access for object storage (required for MinIO)
    usePathAccessStyle: true

  initContainers:
    image:
      # -- Docker registry for init container image
      registry: docker.io
      # -- Init container image repository
      repository: curlimages/curl
      # -- Init container image tag
      tag: "8.17.0"
      # -- Init container image pull policy
      pullPolicy: IfNotPresent

    checkCassandra:
      # -- Add an init container waiting for Cassandra to listen on port 9042
      enabled: true

    checkElasticsearch:
      # -- Add an init container waiting for ElasticSearch to answer when requested /_cluster/health route on port 9200
      enabled: true
      # -- Use HTTPS for ElasticSearch availability check
      useHttps: false

  # -- HTTP secret for TheHive application (must be at least 32 characters)
  httpSecret: "ChangeThisSecretWithOneContainingAtLeast32Chars"
  # -- Name of existing Kubernetes secret containing TheHive HTTP secret
  k8sSecretName: ""
  # -- Key in the secret containing TheHive HTTP secret
  k8sSecretKey: "http-secret"

  cortex:
    # -- Enable Cortex integration (can also configure Cortex servers from TheHive UI)
    enabled: false
    # -- Cortex protocol (http or https)
    protocol: "http"
    # -- List of Cortex server hostnames
    hostnames: []
      #- "mycortex.example.com"
    # -- Cortex server port
    port: 9001
    # -- Cortex API keys (each key maps to a hostname in order)
    api_keys: []
      #- "abcdefghijklmnopqrstuvwxyz012345"
    # -- Name of existing Kubernetes secret containing Cortex API keys (comma-separated format)
    k8sSecretName: ""
    # -- Key in the secret containing Cortex API keys
    k8sSecretKey: "api-keys"

  # -- Custom application.conf configuration file content for TheHive
  configFile: ""
  #configFile: |
  #  # TheHive configuration file
  #  # See https://docs.strangebee.com/thehive/overview/ under the "Configuration" section

  # -- Custom logback.xml logging configuration file content for TheHive
  logbackXml: ""
  #logbackXml: |
  #  <!-- TheHive logs configuration file -->
  #  <!-- See https://docs.strangebee.com/thehive/configuration/logs/ -->

  # -- Extra command-line arguments for TheHive entrypoint
  extraCommand: []

  # -- Extra environment variables for TheHive container
  extraEnv: []
    #- name: "EXAMPLE"
    #  value: "example"
    #- name: "FROM_CM"
    #  valueFrom:
    #    configMapKeyRef:
    #      name: "cm-name"
    #      key: "key-name"
    #- name: "FROM_SECRET"
    #  valueFrom:
    #    secretKeyRef:
    #      name: "cm-name"
    #      key: "key-name"

  startupProbe:
    # -- Enable startup probe (set failureThreshold high to prevent CrashLoops during schema migrations)
    enabled: true
    # -- Initial delay before startup probe begins
    initialDelaySeconds: 0
    # -- Frequency of startup probe checks
    periodSeconds: 5
    # -- Timeout for each startup probe attempt
    timeoutSeconds: 1
    # -- Number of failures before marking pod as failed
    failureThreshold: 36

  livenessProbe:
    # -- Enable liveness probe
    enabled: true
    # -- Initial delay before liveness probe begins
    initialDelaySeconds: 0
    # -- Frequency of liveness probe checks
    periodSeconds: 10
    # -- Timeout for each liveness probe attempt
    timeoutSeconds: 1
    # -- Number of failures before restarting container
    failureThreshold: 3

  readinessProbe:
    # -- Enable readiness probe
    enabled: true
    # -- Initial delay before readiness probe begins
    initialDelaySeconds: 0
    # -- Frequency of readiness probe checks
    periodSeconds: 10
    # -- Timeout for each readiness probe attempt
    timeoutSeconds: 1
    # -- Number of successes before marking pod as ready
    successThreshold: 1
    # -- Number of failures before marking pod as not ready
    failureThreshold: 3

  serviceAccount:
    # -- Create a service account for TheHive
    create: true
    # -- Name of the service account (generated if empty)
    name: ""
    # -- Annotations for the service account
    annotations: {}
    # -- Automatically mount Kubernetes API credentials
    automountServiceAccountToken: true

  # -- Pod-wide security context
  podSecurityContext: {}
    #fsGroup: 2000

  # -- Container-level security context
  securityContext: {}
    #allowPrivilegeEscalation: false

  service:
    # -- Kubernetes service type
    type: ClusterIP
    # -- TheHive application port
    port: 9000

  monitoring:
    # -- Enable monitoring port exposure (edit application.conf to configure Kamon)
    enabled: true
    # -- Monitoring metrics port
    port: 9095

  ingress:
    # -- Enable ingress resource creation
    enabled: false
    # -- Ingress class name
    className: ""
    # -- Ingress annotations
    annotations: {}
      #kubernetes.io/ingress.class: nginx
      #kubernetes.io/tls-acme: "true"
    # -- Ingress hosts configuration
    hosts:
      # -- A DNS name to access TheHive
      - host: thehive.example
        paths:
          - path: /
            pathType: ImplementationSpecific
    # -- Ingress TLS configuration
    tls: []
      #- secretName: thehive-tls
      #  hosts:
      #    - thehive.example

  # -- Additional volumes for TheHive deployment
  volumes: []
    #- name: foo
    #  secret:
    #    secretName: mysecret
    #    optional: false

  # -- Additional volume mounts for TheHive container
  volumeMounts: []
    #- name: foo
    #  mountPath: "/etc/foo"
    #  readOnly: true

  # -- Node selector for pod assignment
  nodeSelector: {}

  # -- Tolerations for pod assignment
  tolerations: []

  # -- Affinity rules for pod assignment
  affinity: {}

################################
# Cassandra subchart variables #
################################

# https://github.com/bitnami/charts/blob/cassandra/12.3.11/bitnami/cassandra/values.yaml
cassandra:
  # -- Enable Cassandra dependency subchart deployment
  enabled: true

  global:
    security:
      # -- Allow the use of insecure images from bitnamilegacy repository
      allowInsecureImages: true

  image:
    # -- Cassandra image registry
    registry: docker.io
    # -- Cassandra image repository
    repository: bitnamilegacy/cassandra
    # -- Cassandra image tag
    tag: "4.1.7-debian-12-r3"

  dbUser:
    # -- Cassandra database username
    user: "cassandra"
    # -- Cassandra database password
    password: "ChangeThisPasswordForCassandra"
    # -- Force password update on deployment
    forcePassword: false
    # -- Name of existing secret with Cassandra password (expects .data.cassandra-password key)
    existingSecret: ""

  cluster:
    # -- Cassandra cluster name
    name: "TheHive"
    # -- Cassandra datacenter name
    datacenter: "DC1-TheHive"
    # -- Cassandra rack name
    rack: "Rack1-TheHive"

  # -- Number of Cassandra replicas
  replicaCount: 1

  pdb:
    # -- Create PodDisruptionBudget for Cassandra
    create: true
    # -- Maximum unavailable Cassandra pods
    maxUnavailable: "1"

  # -- Resource requests and limits for Cassandra pods
  resources:
    requests:
      cpu: "1000m"
      memory: "2048Mi"
      ephemeral-storage: "4Gi"
    limits:
      cpu: "2000m"
      memory: "3584Mi"
      ephemeral-storage: "4Gi"

  jvm:
    # -- Additional JVM options for Cassandra
    extraOpts: "-Xms2g -Xmx2g -Xmn200m"
    # -- Maximum heap size for Cassandra JVM
    maxHeapSize: "2g"
    # -- New generation heap size for Cassandra JVM
    newHeapSize: "200m"

  persistence:
    # -- Enable persistent volume for Cassandra data
    enabled: true
    # -- Storage class for Cassandra persistent volume
    storageClass: ""
    # -- Size of Cassandra persistent volume
    size: "10Gi"

  networkPolicy:
    # -- Enable network policy for Cassandra
    enabled: false

  # -- Extra environment variables for Cassandra
  extraEnvVars:
    # -- Cassandra authenticator (use AllowAllAuthenticator for passwordless)
    - name: CASSANDRA_AUTHENTICATOR
      value: PasswordAuthenticator
    # -- Cassandra authorizer (use AllowAllAuthorizer for passwordless)
    - name: CASSANDRA_AUTHORIZER
      value: CassandraAuthorizer

dynamicSeedDiscovery:
  image:
    # -- Dynamic seed discovery image registry
    registry: docker.io
    # -- Dynamic seed discovery image repository
    repository: bitnamilegacy/os-shell
    # -- Dynamic seed discovery image tag
    tag: 12-debian-12-r51

volumePermissions:
  image:
    # -- Volume permissions init container image registry
    registry: docker.io
    # -- Volume permissions init container image repository
    repository: bitnamilegacy/os-shell
    # -- Volume permissions init container image tag
    tag: 12-debian-12-r51

metrics:
  image:
    # -- Cassandra metrics exporter image registry
    registry: docker.io
    # -- Cassandra metrics exporter image repository
    repository: bitnamilegacy/cassandra-exporter
    # -- Cassandra metrics exporter image tag
    tag: 2.3.8-debian-12-r51

####################################
# ElasticSearch subchart variables #
####################################

# https://github.com/bitnami/charts/blob/elasticsearch/22.1.6/bitnami/elasticsearch/values.yaml
elasticsearch:
  # -- Enable ElasticSearch dependency subchart deployment
  enabled: true

  global:
    security:
      # -- Allow the use of insecure images from bitnamilegacy repository
      allowInsecureImages: true

  image:
    # -- ElasticSearch image registry
    registry: docker.io
    # -- ElasticSearch image repository
    repository: bitnamilegacy/elasticsearch
    # -- ElasticSearch image tag
    tag: "9.1.2-debian-12-r0"

  security:
    # -- TLS configuration for ElasticSearch
    tls: {}
    # -- Enable security features (requires TLS configuration)
    enabled: false
    # -- ElasticSearch elastic user password
    elasticPassword: ""
    # -- Name of existing secret with ElasticSearch password (expects .data.elasticsearch-password key)
    existingSecret: ""

  master:
    # -- Deploy master-only nodes or multipurpose nodes (master, data, coordinating, ingest)
    masterOnly: false

    # -- Number of master-eligible ElasticSearch replicas
    replicaCount: 1
    pdb:
      # -- Create PodDisruptionBudget for ElasticSearch master nodes
      create: true
      # -- Maximum unavailable master nodes
      maxUnavailable: "1"

    # -- Resource requests and limits for ElasticSearch master nodes
    resources:
      requests:
        cpu: "1000m"
        memory: "2048Mi"
        ephemeral-storage: "4Gi"
      limits:
        cpu: "2000m"
        memory: "3584Mi"
        ephemeral-storage: "4Gi"

    # -- Heap size for ElasticSearch master nodes
    heapSize: "2g"
    # -- Extra environment variables for ElasticSearch master nodes
    extraEnvVars:
      - name: JVM_OPTS
        value: "-Xms2g -Xmx2g -Xmn200m"

    persistence:
      # -- Enable persistent volume for ElasticSearch master nodes
      enabled: true
      # -- Storage class for ElasticSearch master node persistent volume
      storageClass: ""
      # -- Size of ElasticSearch master node persistent volume
      size: "10Gi"

    networkPolicy:
      # -- Enable network policy for ElasticSearch master nodes
      enabled: false

  data:
    # -- Number of data-dedicated node replicas (disabled by default)
    replicaCount: 0

  coordinating:
    # -- Number of coordinating-dedicated node replicas (disabled by default)
    replicaCount: 0

  ingest:
    # -- Number of ingest-dedicated node replicas (disabled by default)
    replicaCount: 0

  metrics:
    image:
      # -- ElasticSearch metrics exporter image registry
      registry: docker.io
      # -- ElasticSearch metrics exporter image repository
      repository: bitnamilegacy/elasticsearch-exporter
      # -- ElasticSearch metrics exporter image tag
      tag: 1.9.0-debian-12-r16

  volumePermissions:
    image:
      # -- Volume permissions init container image registry
      registry: docker.io
      # -- Volume permissions init container image repository
      repository: bitnamilegacy/os-shell
      # -- Volume permissions init container image tag
      tag: 12-debian-12-r51

  sysctlImage:
    # -- Sysctl init container image registry
    registry: docker.io
    # -- Sysctl init container image repository
    repository: bitnamilegacy/os-shell
    # -- Sysctl init container image tag
    tag: 12-debian-12-r51

############################
# MinIO subchart variables #
############################

minio:
  # -- Enable [MinIO](https://github.com/minio/minio/blob/master/helm/minio/values.yaml) dependency subchart deployment (disable if using external S3-compatible storage or a filesystem shared between pods)
  enabled: true

  image:
    # -- MinIO image repository
    repository: quay.io/minio/minio
    # -- MinIO image tag
    tag: RELEASE.2025-09-07T16-13-09Z

  mcImage:
    # -- MinIO client (mc) image repository
    repository: quay.io/minio/mc
    # -- MinIO client (mc) image tag
    tag: RELEASE.2025-08-13T08-35-41Z

  # -- MinIO root username
  rootUser: "minio"
  # -- MinIO root password
  rootPassword: "ChangeThisPasswordForMinIO"
  # -- Name of existing secret with MinIO credentials (expects .data.rootUser and .data.rootPassword keys)
  existingSecret: ""

  # -- MinIO deployment mode (standalone or distributed)
  mode: standalone
  # -- Number of drives per MinIO node
  drivesPerNode: 1
  # -- Number of MinIO pod replicas
  replicas: 1
  # -- Number of expanded MinIO clusters
  pools: 1

  podDisruptionBudget:
    # -- Enable PodDisruptionBudget for MinIO
    enabled: true
    # -- Maximum unavailable MinIO pods
    maxUnavailable: 1

  # -- MinIO bucket configuration
  buckets:
    - name: thehive
      policy: none
      purge: false
      versioning: false
      objectlocking: false

  # -- Resource requests and limits for MinIO pods
  resources:
    requests:
      cpu: "500m"
      memory: "2Gi"
      ephemeral-storage: "4Gi"
    limits:
      cpu: "1000m"
      memory: "2Gi"
      ephemeral-storage: "4Gi"

  persistence:
    # -- Enable persistent volume for MinIO data
    enabled: true
    # -- Storage class for MinIO persistent volume
    storageClass: ""
    # -- Size of MinIO persistent volume
    size: "10Gi"
